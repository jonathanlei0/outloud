(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();let i={speed:"normal",voice:"",autoRead:!1,languageDetection:"auto"};const y=document.getElementById("speakSelected"),b=document.getElementById("stopSpeaking"),u=document.getElementById("speed"),s=document.getElementById("voice"),g=document.getElementById("autoRead"),m=document.getElementById("languageDetection"),h=document.getElementById("languageDetectionSetting");document.addEventListener("DOMContentLoaded",async()=>{await v(),await S(),w(),E()});async function v(){const t=await chrome.storage.local.get(["voiceSettings"]);t.voiceSettings&&(i={...i,...t.voiceSettings})}async function c(){await chrome.storage.local.set({voiceSettings:i});const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});t!=null&&t.id&&await f(t.id)&&p(t.id,{type:"UPDATE_AUTO_READ_SETTINGS",settings:i})}async function S(){const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});t!=null&&t.id&&await f(t.id)?p(t.id,{type:"GET_VOICES"},r=>{r&&r.voices?d(r.voices):d([{id:"694f9389-aac1-45b6-b726-9d9369183238",name:"Default Voice",language:"en"},{id:"a0e99841-438c-4a64-b679-ae501e7d6091",name:"British Male",language:"en"},{id:"2ee87190-8f84-4925-97da-e52547f9462c",name:"American Female",language:"en"},{id:"820a3788-2b37-4d21-847a-b65d8a68c99a",name:"Australian Male",language:"en"},{id:"87748186-23bb-4158-a1eb-332911b0b708",name:"中文女声",language:"zh"},{id:"b9de4a89-2f3e-4f5c-9b8d-7c4a6b2f8e3d",name:"中文男声",language:"zh"}])}):d([{id:"694f9389-aac1-45b6-b726-9d9369183238",name:"Default Voice",language:"en"},{id:"a0e99841-438c-4a64-b679-ae501e7d6091",name:"British Male",language:"en"},{id:"2ee87190-8f84-4925-97da-e52547f9462c",name:"American Female",language:"en"},{id:"820a3788-2b37-4d21-847a-b65d8a68c99a",name:"Australian Male",language:"en"},{id:"87748186-23bb-4158-a1eb-332911b0b708",name:"中文女声",language:"zh"},{id:"b9de4a89-2f3e-4f5c-9b8d-7c4a6b2f8e3d",name:"中文男声",language:"zh"}])}async function f(t){return new Promise(r=>{chrome.tabs.sendMessage(t,{type:"PING"},n=>{chrome.runtime.lastError?(console.log("Content script not ready:",chrome.runtime.lastError.message),r(!1)):r(!0)})})}function p(t,r,n){chrome.tabs.sendMessage(t,r,a=>{chrome.runtime.lastError?(console.error("Error sending message to tab:",chrome.runtime.lastError.message),n&&n(null)):n&&n(a)})}function d(t){s.innerHTML='<option value="">Auto-select by language</option>';const r=t.filter(a=>a.language==="en"),n=t.filter(a=>a.language==="zh");if(r.length>0){const a=document.createElement("optgroup");a.label="English",r.forEach(e=>{const o=document.createElement("option");o.value=e.id,o.textContent=e.name,a.appendChild(o)}),s.appendChild(a)}if(n.length>0){const a=document.createElement("optgroup");a.label="中文",n.forEach(e=>{const o=document.createElement("option");o.value=e.id,o.textContent=e.name,a.appendChild(o)}),s.appendChild(a)}s.value=i.voice}function w(){g.addEventListener("change",()=>{i.autoRead=g.checked,E(),c()}),m.addEventListener("change",()=>{i.languageDetection=m.value,c()}),y.addEventListener("click",async()=>{const r=(await chrome.storage.local.get(["lastSelectedText"])).lastSelectedText;if(r)chrome.runtime.sendMessage({type:"SPEAK_TEXT",text:r,options:i},n=>{chrome.runtime.lastError?(console.error("Error sending message to background:",chrome.runtime.lastError.message),alert("Error: Could not communicate with background script")):n&&!n.success&&alert(`Error: ${n.error}`)}),window.close();else{const[n]=await chrome.tabs.query({active:!0,currentWindow:!0});n!=null&&n.id&&await f(n.id)?p(n.id,{type:"GET_SELECTION"},a=>{a&&a.text?(chrome.runtime.sendMessage({type:"SPEAK_TEXT",text:a.text,options:i},e=>{chrome.runtime.lastError?(console.error("Error sending message to background:",chrome.runtime.lastError.message),alert("Error: Could not communicate with background script")):e&&!e.success&&alert(`Error: ${e.error}`)}),window.close()):alert("Please select some text on the page first.")}):alert("Please select some text on the page first, or make sure you're on a regular webpage (not a chrome:// page).")}}),b.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"STOP_SPEAKING"},t=>{chrome.runtime.lastError&&console.error("Error sending stop message:",chrome.runtime.lastError.message)}),window.close()}),u.addEventListener("change",()=>{i.speed=u.value,c()}),s.addEventListener("change",()=>{i.voice=s.value,c()})}function E(){u.value=i.speed,s.value=i.voice,g.checked=i.autoRead,m.value=i.languageDetection,i.autoRead?h.style.display="flex":h.style.display="none"}
