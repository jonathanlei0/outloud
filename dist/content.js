let o=null;document.addEventListener("mouseup",()=>{var l;const e=(l=window.getSelection())==null?void 0:l.toString().trim();e&&e.length>0&&chrome.storage.local.set({lastSelectedText:e})});document.addEventListener("keydown",e=>{var l;if((e.ctrlKey||e.metaKey)&&e.shiftKey&&e.key==="S"){e.preventDefault();const t=(l=window.getSelection())==null?void 0:l.toString().trim();t&&chrome.runtime.sendMessage({type:"SPEAK_TEXT",text:t,options:{}})}});chrome.runtime.onMessage.addListener((e,l,t)=>{var a;if(e.type==="PING")return t({ready:!0}),!0;if(e.type==="PLAY_AUDIO")return console.log("Content script received PLAY_AUDIO message"),console.log("Audio data length:",e.audioData?e.audioData.length:"undefined"),console.log("MIME type:",e.mimeType),u(e.audioData,e.mimeType),t({success:!0}),!0;if(e.type==="STOP_AUDIO")return d(),t({success:!0}),!0;if(e.type==="GET_SELECTION"){const r=(a=window.getSelection())==null?void 0:a.toString().trim();return t({text:r||""}),!0}return e.type==="GET_VOICES"?(t({voices:[{id:"694f9389-aac1-45b6-b726-9d9369183238",name:"Default Voice",language:"en"},{id:"a0e99841-438c-4a64-b679-ae501e7d6091",name:"British Male",language:"en"},{id:"2ee87190-8f84-4925-97da-e52547f9462c",name:"American Female",language:"en"},{id:"820a3788-2b37-4d21-847a-b65d8a68c99a",name:"Australian Male",language:"en"}]}),!0):!1});function u(e,l){console.log("üéµ playAudio function called"),console.log("Base64 data received:",e?`${e.length} characters`:"null/undefined"),console.log("MIME type:",l);try{if(d(),!e){console.error("‚ùå No audio data provided");return}console.log("üîÑ Converting base64 to blob...");const t=atob(e);console.log("Binary string length:",t.length);const a=new Uint8Array(t.length);for(let n=0;n<t.length;n++)a[n]=t.charCodeAt(n);const r=new Blob([a],{type:l});console.log("Blob created:",r.size,"bytes, type:",r.type),o=new Audio;const c=URL.createObjectURL(r);o.src=c,console.log("üéß Audio element created with URL:",c),o.onloadstart=()=>{console.log("üîÑ Audio loading started")},o.oncanplay=()=>{console.log("‚úÖ Audio can play")},o.onplay=()=>{console.log("‚ñ∂Ô∏è Started playing Cartesia audio")},o.onended=()=>{console.log("‚èπÔ∏è Finished playing audio"),i()},o.onerror=n=>{console.error("‚ùå Audio playback error:",n),console.error("Audio error event:",o==null?void 0:o.error),i()},o.onabort=()=>{console.log("‚è∏Ô∏è Audio playback aborted")},o.onstalled=()=>{console.log("‚è≥ Audio playback stalled")},o.volume=1,console.log("üöÄ Attempting to play audio..."),o.play().then(()=>{console.log("‚úÖ Audio play() promise resolved")}).catch(n=>{console.error("‚ùå Failed to play audio:",n),console.error("Error name:",n.name),console.error("Error message:",n.message),i()})}catch(t){console.error("‚ùå Error in playAudio function:",t)}}function d(){o&&(console.log("‚èπÔ∏è Stopping audio"),o.pause(),o.currentTime=0,i())}function i(){o&&(console.log("üßπ Cleaning up audio"),o.src&&URL.revokeObjectURL(o.src),o=null)}console.log("OutLoud content script loaded with Cartesia audio support");
